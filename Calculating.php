<?php
////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////Brackets/////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
/*----------------------------------Result:-----------------------------------*/
/*----------------------------------------------------------------------------*/  
/*------------------------------arr(status, msg)------------------------------*/
/*----------------------------------------------------------------------------*/  

/*------Входные данные------*/
$str = '(}a b [c d] () t y o){';

function Brackets($str){
    
    $count = strlen($str);
    $brackets = [];
    
    ////////////////////////////////////////////////
    /*---Создаем массив для удобной работы с ним---*/
        for($i=0;$i<$count;$i++){
            switch($str[$i]){
                
                case'(':
                    array_push($brackets,0);
                break;
                
                case')':
                    array_push($brackets,1);
                break;
                
                case'[':
                    array_push($brackets,3);
                break;
                
                case']':
                    array_push($brackets,4);
                break;
                
                case'{':
                    array_push($brackets,6);
                break;
                
                case'}':
                    array_push($brackets,7);
                break;
            }
        }
    /*--------------------------------------------*/  
    ////////////////////////////////////////////////
       
       
       
    ////////////////////////////////////////////////
    /*-----Обрабатываем созданый ранее массив-----*/
    while(1){
        $flag = false;
        $count = count($brackets);
        
        for($i=0;$i<$count;$i++){
            if($brackets[$i]-1 == $brackets[$i-1]){
                array_splice($brackets, $i-1,2); 
                $flag = true;
            }
        }
        
        if(!$flag){
            return $return = ['status' => 'error', 'msg' => 'Скобки раставлены не верно!'];
        }elseif($brackets == null){
            return $return = ['status' => 'ok', 'msg' => 'Все скобки раставлены верно!'];
        }
    }
    /*---------------------------------------------*/
    ////////////////////////////////////////////////
}

/*------Вывод------*/
print_r(Brackets($str)['msg']);





////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////Calculating///////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
/*----------------------------------Result:-----------------------------------*/
/*----------------------------------------------------------------------------*/  
/*--------------------------------str(result)---------------------------------*/
/*----------------------------------------------------------------------------*/  

/*------Входные данные------*/
$str = '2+2+2-1';

function Calculating ($str){
$num_s = [];
$sign_s = [];
    
    $count  = strlen($str);
    /////////////////////////////////////////////
    /*--------------Создаем стеки--------------*/
    for($i=0;$i<$count;$i++){
        if(is_numeric($str[$i])) $num .= $str[$i];
        else{
           array_push($num_s,$num);
           array_push($sign_s,"{$str[$i]}");
           $num = '';
        }
    } if($num != null) array_push($num_s,$num);
    /*-----------------------------------------*/
    /////////////////////////////////////////////
    
    
    
    $count = count($num_s);
    ////////////////////////////////////////////////////////
    /*------------------------Вычисляем-------------------*/
    for($i=0;$i<=$count;$i++){
        $sign = array_shift($sign_s);
        $num1 = array_shift($num_s);
        $num2 = array_shift($num_s);
        
        if($sign == '-') array_unshift($num_s,$num1 - $num2);
        else array_unshift($num_s,$num1 + $num2);
    }
    /*----------------------------------------------------*/
    ////////////////////////////////////////////////////////
    
return $num_s[0];
}

/*------Вывод------*/
print_r(Calculating ($str));

?>